@using Shop.Web.ViewModels.Cart
@model CartIndexViewModel

@{
    ViewData["Title"] = "Carrito";
}

@section Scripts {
    <link rel="stylesheet" href="~/css/cart.css" asp-append-version="true" />
}

<div class="cart-head a-fadeUp">
    <h1 class="m-0">Carrito</h1>
    @if (Model.Items.Any())
    {
        <span class="badge badge-soft">@Model.Items.Count item(s)</span>
    }
</div>

@if (!Model.Items.Any())
{
    <div class="alert alert-info a-fadeUp" style="animation-delay:.05s">
        No hay productos en el carrito.
    </div>

    <a class="btn btn-primary a-fadeUp" style="animation-delay:.08s"
       asp-controller="Catalog" asp-action="Index">
        Ir al catálogo
    </a>
}
else
{
    <div class="cart-wrap a-fadeUp" style="animation-delay:.06s">

        <!-- LISTA -->
        <div class="cart-list">
            @foreach (var item in Model.Items)
            {
                Model.ProductThumbnails.TryGetValue(item.ProductId, out var thumbUrl);
                var img = !string.IsNullOrWhiteSpace(thumbUrl)
                ? thumbUrl
                : Url.Content("~/images/product-placeholder.jpg");

                <div class="cart-item hover-lift">
                    <div class="cart-item__inner">
                        <img class="cart-thumb"
                             src="@img"
                             alt="@item.ProductTitle"
                             onerror="this.onerror=null; this.src='@Url.Content("~/images/product-placeholder.jpg")';" />

                        <div class="cart-meta">
                            <p class="cart-title">@item.ProductTitle</p>

                            <div class="cart-subline">
                                <span>Precio: <span class="cart-price">@item.UnitPrice.ToString("C")</span></span>
                                <span>Cantidad: <span class="cart-qty">@item.Quantity</span></span>
                            </div>
                        </div>

                        <div class="cart-right">
                            <div class="cart-subtotal">
                                @((item.UnitPrice * item.Quantity).ToString("C"))
                            </div>

                            <form asp-action="Remove" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="productId" value="@item.ProductId" />
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    Eliminar
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            }

            <div class="cart-actions">
                <form asp-action="Clear" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-outline-warning">
                        Vaciar carrito
                    </button>
                </form>

                <a class="btn btn-outline-dark" asp-controller="Catalog" asp-action="Index">
                    Seguir comprando
                </a>
            </div>
        </div>

        <!-- RESUMEN -->
        <aside class="cart-summary">
            <h3>Resumen</h3>

            <div class="summary-row">
                <span class="summary-label">Total</span>
                <span class="summary-value">@Model.Total.ToString("C")</span>
            </div>

            <form asp-controller="Orders" asp-action="Checkout" method="post" class="mt-3">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-success w-100">
                    Confirmar pedido
                </button>
            </form>

            <div class="summary-note">
                Al confirmar, se crea tu orden y luego podrás pagarla en “Órdenes”.
            </div>
        </aside>

    </div>
}
