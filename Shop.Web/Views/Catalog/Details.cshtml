@using Shop.Contracts.Catalog
@model ProductDto

@{
    ViewData["Title"] = Model.Title;

    var fullStars = (int)Math.Round(Model.Rating);
    if (fullStars < 0) fullStars = 0;
    if (fullStars > 5) fullStars = 5;
    var emptyStars = 5 - fullStars;

    var img = !string.IsNullOrWhiteSpace(Model.Thumbnail)
        ? Model.Thumbnail
        : Url.Content("~/images/product-placeholder.jpg");
}

<div class="pd-wrap a-fadeUp">
    <div class="pd-inner">
        <div class="pd-grid">

            <!-- IMAGEN -->
            <div class="pd-media hover-lift">
                <img src="@img"
                     alt="@Model.Title"
                     onerror="this.onerror=null; this.src='@Url.Content("~/images/product-placeholder.jpg")';" />
            </div>

            <!-- INFO -->
            <div>
                <h1 class="pd-title">@Model.Title</h1>

                <div class="pd-badges">
                    @if (!string.IsNullOrWhiteSpace(Model.Category))
                    {
                        <span class="pill">🏷️ @Model.Category</span>
                    }
                    @if (!string.IsNullOrWhiteSpace(Model.Brand))
                    {
                        <span class="pill">🏭 @Model.Brand</span>
                    }
                </div>

                <div class="pd-price text-success">@Model.Price.ToString("C")</div>

                <div class="pd-rating">
                    <div class="stars" aria-label="Rating">
                        @for (int i = 0; i < fullStars; i++)
                        {
                            <span class="star-on">★</span>
                        }
                        @for (int i = 0; i < emptyStars; i++)
                        {
                            <span class="star-off">★</span>
                        }
                    </div>
                    <span class="pd-muted">(@Model.Rating.ToString("0.0") / 5)</span>
                </div>

                @if (!string.IsNullOrWhiteSpace(Model.Description))
                {
                    <p class="pd-desc">
                        @Model.Description
                    </p>
                }

                <!-- ACCIONES -->
                <div class="pd-actions">
                    <form asp-controller="Cart" asp-action="Add" method="post" class="m-0">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="productId" value="@Model.Id" />

                        <div class="input-group qty-group">
                            <span class="input-group-text">Cantidad</span>
                            <input type="number"
                                   name="quantity"
                                   value="1"
                                   min="1"
                                   class="form-control" />
                            <button type="submit" class="btn btn-success">
                                Agregar al carrito
                            </button>
                        </div>
                    </form>

                    <a asp-action="Index" class="btn btn-outline-dark">
                        Volver al catálogo
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>
